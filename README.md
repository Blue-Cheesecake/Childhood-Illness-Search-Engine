# Childhood-Illness-Search-Engine

## How to run Program

### 1. Start Elasticsearch Server

#### Install Docker Desktop or Docker Engine

Install the appropriate <a href="https://docs.docker.com/get-docker/">Docker application</a> for your operating system.

NOTE: Make sure that Docker is allotted at least 4GiB of memory. In Docker Desktop, you configure resource usage on the Advanced tab in Preference (macOS) or Settings (Windows).

#### Pull the Elasticsearch Docker image

Obtaining Elasticsearch for Docker is as simple as issuing a docker pull command against the Elastic Docker registry.

```bash
$ docker pull docker.elastic.co/elasticsearch/elasticsearch:8.5.0
```

#### Start a single-node cluster with Docker

The following commands start a single-node Elasticsearch cluster for development or testing.

1. Create a new docker network for Elasticsearch

```bash
$ docker network create elastic
```

2. Start Elasticsearch in Docker. A password is generated for the elastic user and output to the terminal.

```bash
$ docker run --name es01 --net elastic -p 9200:9200 -p 9300:9300 -it docker.elastic.co/elasticsearch/elasticsearch:8.5.0
```

3. Copy the generated password token and save them in a secure location. These values are shown only when you start Elasticsearch for the first time.

4. Copy the `http_ca.crt` security certificate from your Docker container to your local machine.

```bash
$ docker cp es01:/usr/share/elasticsearch/config/certs/http_ca.crt .
```

NOTE: Do remember the path you copy `http_ca.crt` from this step because it will copy file to the current path.

You can check the current path by using `pwd` and `ls` to see that `http_ca.crt` is in this path.

```bash
$ pwd
/Users/cheesecake
$ ls
Applications        Library             Public              nltk_data
Desktop             Movies              StudioProjects      sketchybarrc
Documents           Music               zshrc
Downloads           Pictures            http_ca.crt
IdeaProjects        Postman
```

5. Open a new terminal and verify that you can connect to your Elasticsearch cluster by making an authenticated call, using the `http_ca.crt` file that you copied from your Docker container. Enter the password for the elastic user when prompted.

```bash
curl --cacert http_ca.crt -u elastic https://localhost:9200
```

It should show some result like following image if it work correctly.

![Example](./ex_docker_succ.png)

### 2. Start Backend Server

1. Make server folder to be virtual environment (venv). Make sure that that current path is root of repo

```bash
$ pwd
/path/to/GitHub/Childhood-Illness-Search-Engine
$ ls
README.md  client  design  server
# if you don't already have virtualenv installed
$ pip install virtualenv
$ virtualenv server
```

2. Access server path. Install all requirements

```bash
$ cd server
$ pwd
/path/to/GitHub/Childhood-Illness-Search-Engine/server
$ pip install -r requirements.txt
```

3. Access to app folder, create `.env` file in /app/.env to store elastic password and ca certificate path.

```bash
$ cd app
$ pwd
/path/to/GitHub/Childhood-Illness-Search-Engine/server/app
$ touch .env
```

4. Edit `.env` file. You can use any text editor to open and it. Insert the following text.

```python
# Password for the 'elastic' user generated by Elasticsearch
# NOTE: Don't forget to change to be compatible with your environemnt
ELASTIC_PASSWORD = "password_of_elastic"
CA_CERTS_PATH = "~/http_ca.crt"
```

NOTE 1: Please make sure that you are running elasticsearch by instruction provided above. See <a>Start Elasticsearch Server</a>

NOTE 2: Do not forget to replace `password_of_elastic` to be current password. The password can be found in terminal running elasticsearch. For example, based on image below, the password is `*TxugNZbdv2s*MUzScX-`

![Example](./ex_pass_elastic.png)

The final file of `.env` will be look like this:

```python
# Password for the 'elastic' user generated by Elasticsearch
# NOTE: Don't forget to change to be compatible with your environemnt
ELASTIC_PASSWORD = "*TxugNZbdv2s*MUzScX-"
CA_CERTS_PATH = "~/http_ca.crt"
```

5. Access back to server folder.

```bash
$ cd ..
$ pwd
/path/to/GitHub/Childhood-Illness-Search-Engine/server
```

6. Run in **local** device

```bash
python3 app/app.py
```

or

```bash
python app/app.py
```

6. (**Optional**) Run [**local**] in development mode. This step require to install nodejs and nodemon package.

```bash
nodemon --exec python3 app/app.py
```
